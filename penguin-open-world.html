<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arctic Penguin Adventure</title>
    <style>
      :root {
        color-scheme: dark;
      }

      body {
        margin: 0;
        overflow: hidden;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        background: #061526;
      }

      #hud {
        position: fixed;
        top: 16px;
        left: 16px;
        z-index: 2;
        background: rgba(5, 17, 35, 0.7);
        backdrop-filter: blur(6px);
        border: 1px solid rgba(140, 220, 255, 0.35);
        border-radius: 14px;
        color: #def7ff;
        padding: 12px 14px;
        width: min(360px, calc(100vw - 32px));
        box-shadow: 0 10px 32px rgba(0, 0, 0, 0.35);
      }

      #hud h1 {
        margin: 0 0 8px;
        font-size: 1rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      #hud p,
      #hud li {
        margin: 4px 0;
        font-size: 0.92rem;
        line-height: 1.3;
      }

      #hud ul {
        margin: 6px 0 0 16px;
        padding: 0;
      }

      #quest {
        color: #9ff6e0;
        font-weight: 700;
      }

      #hint {
        position: fixed;
        bottom: 16px;
        right: 16px;
        z-index: 2;
        background: rgba(7, 21, 40, 0.7);
        border: 1px solid rgba(140, 220, 255, 0.3);
        padding: 10px 12px;
        border-radius: 12px;
        color: #c8ecff;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <section id="hud" aria-live="polite">
      <h1>Arctic Penguin Adventure</h1>
      <p>Explore a frosty open world inspired by creature-adventure games.</p>
      <p><strong>Fish collected:</strong> <span id="fishCount">0</span> / 8</p>
      <p><strong>Current quest:</strong> <span id="quest">Gather fish for the village elder.</span></p>
      <ul>
        <li>Move: <strong>WASD</strong> or <strong>Arrow Keys</strong></li>
        <li>Dash: <strong>Shift</strong></li>
        <li>Camera orbit: <strong>Mouse drag</strong></li>
      </ul>
    </section>
    <div id="hint">Walk near glowing fish to collect them.</div>

    <script type="module">
      import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js";
      import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/controls/OrbitControls.js";

      const scene = new THREE.Scene();
      scene.fog = new THREE.Fog(0x88bdd9, 20, 180);

      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 500);
      camera.position.set(0, 12, 18);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      document.body.appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enablePan = false;
      controls.maxDistance = 28;
      controls.minDistance = 8;
      controls.maxPolarAngle = Math.PI * 0.49;
      controls.target.set(0, 2, 0);

      const hemi = new THREE.HemisphereLight(0xb8e9ff, 0x24445a, 1.05);
      scene.add(hemi);

      const sun = new THREE.DirectionalLight(0xffffff, 1.1);
      sun.position.set(24, 30, 10);
      scene.add(sun);

      const world = new THREE.Group();
      scene.add(world);

      const groundMat = new THREE.MeshStandardMaterial({ color: 0xe8f8ff, roughness: 0.95 });
      const iceMat = new THREE.MeshStandardMaterial({ color: 0x7dd8ff, roughness: 0.2, metalness: 0.15 });

      const islandPositions = [
        [0, 0, 0],
        [28, 0, -10],
        [-30, 0, -18],
        [18, 0, 26],
        [-24, 0, 22],
      ];

      islandPositions.forEach(([x, y, z], idx) => {
        const radius = idx === 0 ? 30 : 18;
        const geo = new THREE.CylinderGeometry(radius, radius + 4, 3, 28);
        const island = new THREE.Mesh(geo, groundMat);
        island.position.set(x, y - 1.5, z);
        island.receiveShadow = true;
        world.add(island);

        const icePatch = new THREE.Mesh(new THREE.CircleGeometry(radius * 0.32, 20), iceMat);
        icePatch.rotation.x = -Math.PI / 2;
        icePatch.position.set(x + radius * 0.2, 0.03, z - radius * 0.15);
        world.add(icePatch);
      });

      const penguin = new THREE.Group();
      const body = new THREE.Mesh(
        new THREE.CapsuleGeometry(0.9, 2, 8, 16),
        new THREE.MeshStandardMaterial({ color: 0x182232, roughness: 0.75 })
      );
      body.position.y = 1.6;
      penguin.add(body);

      const belly = new THREE.Mesh(
        new THREE.SphereGeometry(0.72, 18, 16),
        new THREE.MeshStandardMaterial({ color: 0xf4fbff, roughness: 0.9 })
      );
      belly.scale.set(1, 1.2, 0.8);
      belly.position.set(0, 1.3, 0.65);
      penguin.add(belly);

      const beak = new THREE.Mesh(
        new THREE.ConeGeometry(0.18, 0.5, 12),
        new THREE.MeshStandardMaterial({ color: 0xffb347, roughness: 0.55 })
      );
      beak.rotation.x = Math.PI / 2;
      beak.position.set(0, 2.1, 1.05);
      penguin.add(beak);

      const footMat = new THREE.MeshStandardMaterial({ color: 0xfca53c });
      [-0.32, 0.32].forEach((x) => {
        const foot = new THREE.Mesh(new THREE.BoxGeometry(0.45, 0.13, 0.7), footMat);
        foot.position.set(x, 0.08, 0.35);
        penguin.add(foot);
      });
      world.add(penguin);

      const fish = [];
      const fishMat = new THREE.MeshStandardMaterial({ color: 0x8efff5, emissive: 0x146b7a, emissiveIntensity: 0.8 });
      for (let i = 0; i < 8; i += 1) {
        const f = new THREE.Mesh(new THREE.OctahedronGeometry(0.42, 0), fishMat.clone());
        f.position.set((Math.random() - 0.5) * 70, 0.8, (Math.random() - 0.5) * 70);
        f.userData.phase = Math.random() * Math.PI * 2;
        world.add(f);
        fish.push(f);
      }

      const npcMat = new THREE.MeshStandardMaterial({ color: 0x8fabc7, roughness: 0.7 });
      const npcs = [];
      for (let i = 0; i < 6; i += 1) {
        const npc = new THREE.Mesh(new THREE.SphereGeometry(0.55, 16, 16), npcMat);
        npc.position.set((Math.random() - 0.5) * 65, 0.55, (Math.random() - 0.5) * 65);
        npc.userData = {
          angle: Math.random() * Math.PI * 2,
          radius: 2 + Math.random() * 4,
          centerX: npc.position.x,
          centerZ: npc.position.z,
        };
        npcs.push(npc);
        world.add(npc);
      }

      const keys = new Set();
      window.addEventListener("keydown", (e) => keys.add(e.key.toLowerCase()));
      window.addEventListener("keyup", (e) => keys.delete(e.key.toLowerCase()));

      let fishCount = 0;
      const fishCountNode = document.getElementById("fishCount");
      const questNode = document.getElementById("quest");

      const velocity = new THREE.Vector3();
      const direction = new THREE.Vector3();
      const clock = new THREE.Clock();

      function updatePenguin(delta) {
        direction.set(0, 0, 0);
        if (keys.has("w") || keys.has("arrowup")) direction.z -= 1;
        if (keys.has("s") || keys.has("arrowdown")) direction.z += 1;
        if (keys.has("a") || keys.has("arrowleft")) direction.x -= 1;
        if (keys.has("d") || keys.has("arrowright")) direction.x += 1;

        const speed = keys.has("shift") ? 13 : 8;
        if (direction.lengthSq() > 0) {
          direction.normalize();
          const camForward = new THREE.Vector3();
          camera.getWorldDirection(camForward);
          camForward.y = 0;
          camForward.normalize();
          const camRight = new THREE.Vector3(-camForward.z, 0, camForward.x);
          velocity.copy(camForward.multiplyScalar(-direction.z).add(camRight.multiplyScalar(direction.x))).multiplyScalar(speed * delta);
          penguin.position.add(velocity);
          const lookAngle = Math.atan2(velocity.x, velocity.z);
          penguin.rotation.y = lookAngle;
        }

        penguin.position.x = THREE.MathUtils.clamp(penguin.position.x, -78, 78);
        penguin.position.z = THREE.MathUtils.clamp(penguin.position.z, -78, 78);
      }

      function updateWorld(time, delta) {
        fish.forEach((f) => {
          if (!f.visible) return;
          f.rotation.y += 0.025;
          f.position.y = 0.95 + Math.sin(time * 2.8 + f.userData.phase) * 0.22;
          if (f.position.distanceTo(penguin.position) < 1.35) {
            f.visible = false;
            fishCount += 1;
            fishCountNode.textContent = String(fishCount);
            if (fishCount >= 8) {
              questNode.textContent = "Return to the elder! You restored the winter feast.";
            } else {
              questNode.textContent = `Gather fish for the village elder (${fishCount}/8).`;
            }
          }
        });

        npcs.forEach((npc, i) => {
          const p = npc.userData;
          p.angle += 0.9 * delta + i * 0.0002;
          npc.position.x = p.centerX + Math.cos(p.angle) * p.radius;
          npc.position.z = p.centerZ + Math.sin(p.angle) * p.radius;
        });
      }

      function animate() {
        requestAnimationFrame(animate);
        const delta = Math.min(clock.getDelta(), 0.033);
        const elapsed = clock.elapsedTime;

        updatePenguin(delta);
        updateWorld(elapsed, delta);

        controls.target.lerp(new THREE.Vector3(penguin.position.x, 1.6, penguin.position.z), 0.12);
        controls.update();

        renderer.render(scene, camera);
      }

      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
